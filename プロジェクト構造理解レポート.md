# 📊 プロジェクト構造理解レポート

**作成日**: 2025年1月27日  
**プロジェクト**: Blog Writer - AIを活用したブログ記事執筆支援Webアプリケーション

---

## 🎯 プロジェクト概要

### アプリケーションの目的
AIを活用して段階的にブログ記事を執筆できるWebアプリケーション。ユーザーはテーマを入力し、AIが生成した見出し・アウトラインから選択して、セクションごとにコンテンツを執筆・管理できます。

### 主要機能
1. **認証機能**: Supabaseを使用したユーザー認証（サインアップ・ログイン・ログアウト）
2. **記事管理**: 記事の作成・編集・削除・一覧表示
3. **AI生成機能**: Google Gemini APIを使用したコンテンツ生成
   - 見出し生成
   - アウトライン生成
   - セクションコンテンツ生成
4. **自動保存**: 執筆内容の自動保存機能

---

## 🏗️ 技術スタック

### フロントエンド
- **Next.js 15.2.4**: Reactフレームワーク（App Router）
- **TypeScript**: 型安全性
- **Tailwind CSS 4.x**: スタイリング
- **shadcn/ui**: UIコンポーネントライブラリ
- **React 19**: UIライブラリ
- **next-themes**: テーマ管理（ダークモード対応）

### バックエンド・サービス
- **Supabase**: データベース・認証サービス
- **Google Gemini API**: AIコンテンツ生成
- **Next.js API Routes**: サーバーサイドAPI

### 開発ツール
- **Vercel Analytics**: アナリティクス
- **Vercel**: デプロイ先

---

## 📁 プロジェクト構造

```
blog-writer-app/
├── app/                          # Next.js App Router
│   ├── api/                      # API Routes
│   │   ├── ai/                   # AI生成API
│   │   │   ├── generate-headings/route.ts
│   │   │   ├── generate-outline/route.ts
│   │   │   ├── generate-content/route.ts
│   │   │   └── generate-section-content/route.ts
│   │   └── articles/             # 記事管理API
│   │       ├── [id]/
│   │       │   ├── route.ts
│   │       │   └── sections/[sectionId]/route.ts
│   │       └── route.ts
│   ├── auth/                     # 認証ページ
│   │   ├── simple-login/page.tsx
│   │   └── simple-signup/page.tsx
│   ├── articles/                 # 記事一覧ページ
│   │   └── page.tsx
│   ├── theme-input/              # テーマ入力ページ
│   │   └── page.tsx
│   ├── heading-selection/        # 見出し選択ページ
│   │   └── page.tsx
│   ├── outline-editing/           # アウトライン編集ページ
│   │   └── page.tsx
│   ├── writing/                  # 記事執筆ページ
│   │   └── page.tsx
│   ├── layout.tsx                # ルートレイアウト
│   ├── page.tsx                  # ランディングページ
│   └── globals.css               # グローバルスタイル
├── components/                    # Reactコンポーネント
│   ├── ui/                       # shadcn/uiコンポーネント
│   ├── Header.tsx
│   ├── Footer.tsx
│   ├── SimpleSupabaseHeader.tsx
│   ├── SimpleSupabaseAuthGuard.tsx
│   └── ...
├── contexts/                      # React Context
│   └── SimpleSupabaseAuthContext.tsx
├── lib/                           # ライブラリ・ユーティリティ
│   ├── supabase.ts              # Supabaseクライアント
│   ├── gemini.ts                 # Gemini API連携
│   ├── article-service.ts        # 記事サービス
│   └── auth-helpers.ts           # 認証ヘルパー
├── hooks/                         # カスタムフック
│   └── useAutoSave.ts            # 自動保存フック
├── supabase/                      # Supabase設定
│   └── migrations/               # データベースマイグレーション
│       └── 001_create_tables.sql
├── public/                        # 静的ファイル
├── package.json                   # 依存関係
├── next.config.mjs                # Next.js設定
├── tsconfig.json                  # TypeScript設定
├── vercel.json                    # Vercel設定
└── postcss.config.mjs             # PostCSS設定
```

---

## 🔑 環境変数

### 必要な環境変数

```env
# Supabase設定
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key

# Google Gemini API設定
NEXT_PUBLIC_GEMINI_API_KEY=your-gemini-api-key
```

### 環境変数の説明

- **NEXT_PUBLIC_SUPABASE_URL**: SupabaseプロジェクトのURL
- **NEXT_PUBLIC_SUPABASE_ANON_KEY**: Supabaseの匿名キー（公開可能）
- **NEXT_PUBLIC_GEMINI_API_KEY**: Google Gemini APIキー（公開可能）

**注意**: `NEXT_PUBLIC_`プレフィックスが付いている環境変数は、クライアントサイドで使用可能です。

---

## 🗄️ データベース構造

### Supabaseテーブル

#### 1. profiles（ユーザープロファイル）
```sql
- id: UUID (主キー, auth.users参照)
- email: TEXT
- display_name: TEXT
- avatar_url: TEXT
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

#### 2. articles（記事）
```sql
- id: UUID (主キー)
- user_id: UUID (profiles参照)
- title: TEXT
- theme: TEXT
- target_audience: TEXT ('beginner' | 'intermediate' | 'advanced')
- heading: TEXT
- status: TEXT ('draft' | 'published' | 'archived')
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

#### 3. article_sections（記事セクション）
```sql
- id: UUID (主キー)
- article_id: UUID (articles参照)
- section_number: INTEGER
- title: TEXT
- description: TEXT
- content: TEXT
- word_count: INTEGER
- is_completed: BOOLEAN
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

### Row Level Security (RLS)

すべてのテーブルでRLSが有効になっており、ユーザーは自分のデータのみアクセス可能です。

---

## 🔄 データフロー

### 記事執筆フロー

1. **テーマ入力** (`/theme-input`)
   - ユーザーがテーマとターゲット読者を入力
   - AIが見出し候補を生成

2. **見出し選択** (`/heading-selection`)
   - 生成された見出しから選択
   - 選択した見出しでアウトライン生成

3. **アウトライン編集** (`/outline-editing`)
   - 生成されたアウトラインを編集
   - 記事を作成してデータベースに保存

4. **記事執筆** (`/writing`)
   - セクションごとにコンテンツを執筆
   - AI生成機能でセクションコンテンツを生成
   - 自動保存機能で定期的に保存

---

## 🔌 APIエンドポイント

### AI生成API

#### POST `/api/ai/generate-headings`
見出し候補を生成

**リクエスト:**
```json
{
  "theme": "React.jsの基礎",
  "targetAudience": "beginner"
}
```

#### POST `/api/ai/generate-outline`
アウトラインを生成

**リクエスト:**
```json
{
  "heading": "見出しタイトル",
  "targetAudience": "beginner"
}
```

#### POST `/api/ai/generate-section-content`
セクションコンテンツを生成

**リクエスト:**
```json
{
  "sectionTitle": "セクションタイトル",
  "sectionDescription": "セクションの説明",
  "theme": "テーマ",
  "targetAudience": "beginner",
  "heading": "見出し"
}
```

### 記事管理API

#### GET `/api/articles`
記事一覧を取得（認証必要）

#### POST `/api/articles`
記事を作成（認証必要）

#### GET `/api/articles/[id]`
記事詳細を取得（認証必要）

#### PUT `/api/articles/[id]`
記事を更新（認証必要）

#### DELETE `/api/articles/[id]`
記事を削除（認証必要）

#### PUT `/api/articles/[id]/sections/[sectionId]`
記事セクションを更新（認証必要）

---

## 🔐 認証フロー

### Supabase認証

1. **サインアップ** (`/auth/simple-signup`)
   - メールアドレスとパスワードで登録
   - Supabase Authでユーザー作成
   - プロファイルテーブルに自動的にレコード作成

2. **ログイン** (`/auth/simple-login`)
   - メールアドレスとパスワードでログイン
   - セッションを取得

3. **認証状態管理**
   - `SimpleSupabaseAuthContext`で認証状態を管理
   - セッション変更を監視
   - 認証が必要なページは`SimpleSupabaseAuthGuard`で保護

### API認証

すべてのAPIルートで、リクエストヘッダーに`Authorization: Bearer <アクセストークン>`が必要です。

---

## ⚙️ 設定ファイル

### next.config.mjs
```javascript
- typescript.ignoreBuildErrors: true
- images.unoptimized: true
```

### vercel.json
```json
{
  "buildCommand": "npm run build",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "framework": "nextjs",
  "regions": ["nrt1"]
}
```

### tsconfig.json
- TypeScript設定
- パスエイリアス: `@/*` → `./*`

---

## 🚀 Vercelデプロイ準備

### デプロイ前の確認事項

1. ✅ プロジェクト構造の理解完了
2. ✅ 設定ファイルの確認完了
3. ✅ 環境変数の確認完了
4. ⏳ ローカルビルドテスト（実行が必要）
5. ✅ デプロイ手順書の作成完了

### デプロイに必要な情報

1. **Supabase設定**
   - プロジェクトURL
   - 匿名キー

2. **Google Gemini API設定**
   - APIキー

3. **GitHubリポジトリ**
   - コードをプッシュ済み

### デプロイ手順

詳細は `VERCEL_DEPLOY_CHECKLIST.md` を参照してください。

---

## 📝 まとめ

このプロジェクトは、Next.js 15.2.4を使用したモダンなWebアプリケーションです。Supabaseを使用した認証とデータベース、Google Gemini APIを使用したAI生成機能を統合しています。

Vercelへのデプロイ準備は完了しており、以下の手順でデプロイできます：

1. ローカルでビルドテストを実行
2. GitHubリポジトリにコードをプッシュ
3. Vercelダッシュボードでプロジェクトをインポート
4. 環境変数を設定
5. デプロイを実行

---

**作成日**: 2025年1月27日  
**バージョン**: 1.0

