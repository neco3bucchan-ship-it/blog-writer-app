# 🚨 Vercel 緊急修正手順（実行必須）

## ビルドログから判明した問題

```
19:07:02.699 Detected `pnpm-lock.yaml` 9 which may be generated by pnpm@9.x or pnpm@10.x
19:07:02.705 Running "install" command: `npm install`...
19:07:04.801 npm error code ERESOLVE
```

### 問題1: `pnpm-lock.yaml` がまだ検出されている
→ GitHubリポジトリから削除する必要があります

### 問題2: `npm install` が実行されている（`--legacy-peer-deps` なし）
→ Vercelダッシュボードの設定が反映されていません

### 問題3: ビルドが失敗している
→ 上記2つの問題を解決すれば、自動的に解決します

## ✅ 確実な解決手順（必ず順番通りに実行）

### Step 1: GitHubリポジトリから `pnpm-lock.yaml` を削除

ローカルのターミナルまたはコマンドプロンプトで以下を実行：

```bash
# プロジェクトディレクトリに移動
cd "C:\Users\t-ich\Documents\いまにゅClaud AI Cording202507\cord4biz AI cording_20250821から\Webアプリ開発\blog-generator\blog-writer-app"

# pnpm-lock.yamlを削除（既にローカルで削除済みかもしれませんが念のため）
del pnpm-lock.yaml

# package-lock.jsonを確実に生成
npm install

# Gitでpnpm-lock.yamlを削除（重要！）
git rm pnpm-lock.yaml

# 変更をコミット
git add package-lock.json
git commit -m "Remove pnpm-lock.yaml and use npm with legacy-peer-deps"

# GitHubにプッシュ
git push
```

**重要:** `git rm pnpm-lock.yaml` を実行してGitHubリポジトリから削除することが最重要です。

### Step 2: Vercelダッシュボードで Install Command を設定

#### 方法A: Production Overrides で設定（推奨・確実）

1. **Vercelダッシュボードにアクセス**
   - https://vercel.com にログイン
   - プロジェクト「blog-generator」を選択

2. **Settings > Build and Deployment を開く**
   - 左サイドバー「Settings」→「Build and Deployment」

3. **「Production Overrides」セクションを展開**
   - 「Production Overrides」をクリックして展開

4. **「Install Command」を設定**
   - 「Install Command」テキストフィールドを探す
   - テキストフィールドが入力できない場合：
     - 右側の「Override」トグルをオン（青）にする
   - 以下を入力：
     ```
     npm install --legacy-peer-deps
     ```

5. **保存**
   - 「Save」ボタンをクリック

#### 方法B: Project Settings で設定（代替）

1. **「Project Settings」セクションを展開**
   - 「Production Overrides」の下にある「Project Settings」をクリック

2. **「Install Command」を探す**
   - 「Build and Development Settings」セクション内

3. **設定**
   - 「Override」トグルをオン（青）にする
   - `npm install --legacy-peer-deps` を入力
   - 「Save」ボタンをクリック

### Step 3: Root Directory を確認・設定

1. **Settings > Build and Deployment ページ内で下にスクロール**

2. **「Root Directory」セクションを確認**
   - テキストフィールドに `blog-writer-app` が入力されているか確認
   - 空欄の場合は `blog-writer-app` を入力
   - 「Save」ボタンをクリック

### Step 4: 再デプロイ

1. **Deploymentsタブを開く**
   - 上部ナビゲーションバーの「Deployments」をクリック

2. **最新のデプロイメントの右端の「⋯」をクリック**

3. **「Redeploy」を選択**

4. **ビルドログを確認**
   - 「Build Logs」タブをクリック
   - 以下が表示されることを確認：
     ```
     Detected `package-lock.json`
     Running "install" command: `npm install --legacy-peer-deps`...
     ```

## 🔍 確認チェックリスト

以下を順番に確認してください：

### Step 1の確認
- [ ] `git rm pnpm-lock.yaml` を実行した
- [ ] `npm install` を実行して `package-lock.json` を生成した
- [ ] 変更をコミットした
- [ ] GitHubにプッシュした

### Step 2の確認
- [ ] Vercelダッシュボードで「Install Command」を設定した
- [ ] テキストフィールドに `npm install --legacy-peer-deps` を入力した
- [ ] 「Override」トグルがオン（青）になっている
- [ ] 「Save」ボタンをクリックした

### Step 3の確認
- [ ] 「Root Directory」に `blog-writer-app` が設定されている
- [ ] 「Save」ボタンをクリックした

### Step 4の確認
- [ ] 再デプロイを実行した
- [ ] ビルドログで `Detected package-lock.json` が表示されている
- [ ] ビルドログで `npm install --legacy-peer-deps` が実行されている
- [ ] ビルドが成功している（`Build completed successfully`）
- [ ] URLにアクセスしてランディングページが表示される

## ⚠️ 最重要ポイント

1. **`git rm pnpm-lock.yaml` を必ず実行**
   - これを実行しないと、GitHubリポジトリに `pnpm-lock.yaml` が残り続けます
   - Vercelは毎回GitHubからファイルを取得するため、削除が必須です

2. **「Install Command」の「Override」トグルをオン**
   - トグルがオフの場合、テキストフィールドに入力できません
   - トグルをオンにしてから入力してください

3. **「Save」ボタンを必ずクリック**
   - 設定を変更した後、必ず「Save」ボタンをクリックしてください
   - 保存しないと変更が反映されません

## 🚀 期待される結果

上記の手順を実行した後、ビルドログは以下のようになるはずです：

```
Running build in Washington, D.C., USA (East) – iad1
Build machine configuration: 2 cores, 8 GB
Retrieving list of deployment files...
Downloading deployment files...
Running "vercel build"
Vercel CLI 48.9.2
Detected `package-lock.json`  ← ここ！
Running "install" command: `npm install --legacy-peer-deps`...  ← ここ！
✓ Compiled successfully
✓ Build completed successfully  ← ここ！
```

そして、URLにアクセスすると：
- ランディングページが正常に表示される
- 404エラーが表示されない

---

**作成日**: 2025年1月27日  
**バージョン**: 1.0

